<h1>Banquidle</h1>

<%= render "layouts/flash" %>

<%= form_with url: submit_guess_game_index_path, data: { turbo_stream: true }, method: :post, id: "guess-form" do |f| %>
  <%= f.label :quickname, "Choisis une personne :" %>
  <%= f.select :quickname,
               options_for_select(@people.map { |p| [ "#{p.first_name_content} #{p.last_name_content}", p.quickname ] }),
               { include_blank: "----" } %>

  <%= f.submit "Envoyer" %>
<% end %>

<table>
  <thead>
  <tr>
    <th>Pr√©nom</th>
    <th>Nom</th>
    <th>Sexe</th>
    <th>Statut Pro</th>
    <th>Localisation</th>
  </tr>
  </thead>
  <tbody id="guesses">
  <%= render partial: "people/person",
             collection: @prev_people,
             locals: { todays: @todays_person } if defined?(@prev_people) %>
  </tbody>
</table>

<div id="congrats-div">
  <% if @prev_people.include?(@todays_person) %>
    <%= render partial: "game/congratulations", locals: { nb_tries: @nb_tries } %>
  <% end %>
</div>

<%= button_to 'Try Again', retry_path, method: :post %>

<script>
    document.addEventListener("turbo:submit-end", function (event) {
        if (event.target.id === "guess-form") event.target.reset()
    })
</script>